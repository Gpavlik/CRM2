<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∞—Ä—Ç–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #006400, #004d00);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { margin-top: 30px; }
    form {
      max-width: 900px;
      width: 95%;
      margin: 20px auto;
      padding: 20px;
      background: #008000;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    form label { display: block; margin: 12px 0; }
    input {
      width: 98%; padding: 8px;
      border-radius: 6px; border: none;
    }
    .form-actions { margin-top: 20px; }
    .form-actions button, .back-btn {
      margin-right: 10px;
      background: #006400; color: white;
      border: none; cursor: pointer;
      padding: 10px 14px; border-radius: 6px;
      text-decoration: none;
      display: inline-block;
    }
    .form-actions button:hover, .back-btn:hover { background: #003300; }
    .device-block {
      border: 1px solid #ccc; padding: 10px;
      margin-bottom: 12px; background: #fff;
      border-radius: 6px; color: #000;
    }
    #mapContainer {
      margin-top: 20px;
      width: 100%;
      height: 300px;
      border: 2px solid #ccc;
      border-radius: 8px;
      background: #eee;
    }
  </style>
</head>
<body>
  <img src="../logo.svg" alt="logo" width="220">
  <h1>üß™ –ö–∞—Ä—Ç–∫–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó</h1>

  <form id="labForm">
    <label>–ù–∞–∑–≤–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞: <input type="text" id="partnerName"></label>
    <label>–û–±–ª–∞—Å—Ç—å: 
      <input type="text" id="region" list="regionList">
      <datalist id="regionList"></datalist>
    </label>
    <label>–ú—ñ—Å—Ç–æ: 
      <input type="text" id="city" list="cityList">
      <datalist id="cityList"></datalist>
    </label>
    <label>–õ–ü–ó: 
      <input type="text" id="lpz" list="lpzList" onblur="prefillLabData()">
      <datalist id="lpzList"></datalist>
    </label>
    <label>–ê–¥—Ä–µ—Å–∞: <input type="text" id="labAddress"></label>
    <label>–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç: <input type="text" id="contractor"></label>
    <label>–¢–µ–ª–µ—Ñ–æ–Ω: <input type="text" id="phone"></label>
    <label>–Ñ–î–†–ü–û–£: <input type="text" id="labEdrpou"></label>
    <label>–ú–µ–Ω–µ–¥–∂–µ—Ä: <input type="text" id="labManager"></label>

    <!-- –ü—Ä–∏–ª–∞–¥–∏ -->
    <section id="devicesSection" style="display:none;">
      <h2>üîß –ü—Ä–∏–ª–∞–¥–∏</h2>
      <div id="devicesContainer"></div>
      <button type="button" onclick="addDevice()">‚ûï –î–æ–¥–∞—Ç–∏ –ø—Ä–∏–ª–∞–¥</button>
    </section>

    <!-- –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –≤—ñ–∑–∏—Ç—É -->
    <h2>üìÖ –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –≤—ñ–∑–∏—Ç—É</h2>
    <label>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –¥–∞—Ç–∞ –≤—ñ–∑–∏—Ç—É:
      <input type="date" id="recommendedVisitDate">
    </label>
    <button type="button" onclick="suggestVisitDate()">üìÖ –ó–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –¥–∞—Ç—É</button>

    <div class="form-actions">
      <button type="button" onclick="saveLabCard()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
      <button type="button" onclick="updateLabCard(document.getElementById('labEdrpou').value)">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
      <a href="./labs.html" class="back-btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
    </div>
  </form>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏ -->
  <div id="mapContainer">üó∫Ô∏è –¢—É—Ç –±—É–¥–µ –∫–∞—Ä—Ç–∞ –∑ –ª–æ–≥—ñ—Å—Ç–∏–∫–∏</div>

  <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Å–ø—ñ–ª—å–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ -->
  <script src="labcards.js"></script>
  <script src="logistics.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∫–∏ –∑ labcards.js
      initLabCard();
      // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—ñ–¥–∫–∞–∑–æ–∫
      fillRegionOptions();
      fillCityOptions();
      fillLpzOptions();
    });

    function suggestVisitDate() {
      const today = new Date();
      const suggestedDate = new Date(today);
      suggestedDate.setDate(today.getDate() + 7);
      const yyyy = suggestedDate.getFullYear();
      const mm = String(suggestedDate.getMonth() + 1).padStart(2, '0');
      const dd = String(suggestedDate.getDate()).padStart(2, '0');
      document.getElementById("recommendedVisitDate").value = `${yyyy}-${mm}-${dd}`;
    }

    // –ü—Ä–∏–∫–ª–∞–¥ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ logistics.js: –ø–æ–∫–∞–∑ –∫–∞—Ä—Ç–∏ –∑ –∞–¥—Ä–µ—Å–æ—é
    async function showLabOnMap() {
      const city = document.getElementById("city").value;
      const region = document.getElementById("region").value;
      if (!city || !region) return;

      const distance = await getDistanceKmORS("–ö–∏—ó–≤", city);
      document.getElementById("mapContainer").innerHTML =
        `üìç –õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è —É ${city}, ${region}. –í—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥ –ö–∏—î–≤–∞ ‚âà ${Math.round(distance)} –∫–º`;
    }

    document.getElementById("city").addEventListener("blur", showLabOnMap);
  </script>
</body>
</html>
