  <!DOCTYPE html>
<html lang="uk">
<head>
  <link rel="icon" href="data:,">
  <meta charset="UTF-8">
  <title>ğŸ§ª Ğ›Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ½Ğ° ĞºĞ°Ñ€Ñ‚ĞºĞ°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    .device-block { background: #fff; padding: 10px; margin: 10px 0; border-left: 4px solid #0077cc; border-radius: 5px; }
    button { margin-top: 15px; padding: 10px 15px; background: #0077cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #005fa3; }
    .priority-red {
  color: #d00;
  font-weight: bold;
}
.priority-yellow {
  color: #e67e00;
}
.priority-green {
  color: #007f00;
}

  </style>
</head>
<body>
  <h2>ğŸ§ª Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ / Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ–Ñ</h2>

  <label for="partnerName">ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°Ğ³ĞµĞ½Ñ‚:</label>
  <input type="text" id="partnerName">

  <label for="region">ğŸ“ ĞĞ±Ğ»Ğ°ÑÑ‚ÑŒ:</label>
  <input type="text" id="region" list="region-list">
  <datalist id="region-list"></datalist>

  <label for="city">ğŸ™ï¸ ĞœÑ–ÑÑ‚Ğ¾:</label>
  <input type="text" id="city" list="city-list">
  <datalist id="city-list"></datalist>

  <label for="lpz">ğŸ¥ Ğ›ĞŸĞ—:</label>
  <input type="text" id="lpz" list="lpz-list">
  <datalist id="lpz-list"></datalist>

  <label for="labAddress">ğŸ“« ĞĞ´Ñ€ĞµÑĞ°:</label>
  <input type="text" id="labAddress">

  <label for="contractor">ğŸ¤ ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ğ° Ğ¾ÑĞ¾Ğ±Ğ°:</label>
  <input type="text" id="contractor">

  <label for="phone">ğŸ“ Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½:</label>
  <input type="text" id="phone">

  <label for="labEdrpou">ğŸ†” Ğ„Ğ”Ğ ĞŸĞĞ£:</label>
  <input type="text" id="labEdrpou" placeholder="8 Ñ†Ğ¸Ñ„Ñ€">

  <label for="labManager">ğŸ‘¤ Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€:</label>
  <input type="text" id="labManager" placeholder="ĞŸĞ†Ğ‘ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°">

  <h3>ğŸ”§ ĞŸÑ€Ğ¸Ğ»Ğ°Ğ´Ğ¸</h3>
  <div id="devicesContainer"></div>
  <button id="addDeviceBtn">â• Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ´</button>
  <button id="saveLabBtn">ğŸ’¾ Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸</button>


<script type="module" src="labcards.js"></script>
  <script type="module">
  window.addEventListener("DOMContentLoaded", () => {
    // ğŸ”§ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ›ĞŸĞ—
    if (typeof loadLPZList === "function") loadLPZList();

    // ğŸ”§ ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ´
    const addBtn = document.getElementById("addDeviceBtn");
    if (addBtn) {
      addBtn.addEventListener("click", () => {
        if (typeof addDevice === "function") addDevice();
      });
    }

    // ğŸ”§ ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ–Ñ
    const saveBtn = document.getElementById("saveLabBtn");
    if (saveBtn) {
      saveBtn.addEventListener("click", () => {
        if (typeof saveLabCard === "function") saveLabCard();
      });
    }

    // ğŸ”§ ĞĞ²Ñ‚Ğ¾Ğ¿Ñ–Ğ´ĞºĞ°Ğ·ĞºĞ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ³Ñ–Ğ¾Ğ½Ñƒ/Ğ¼Ñ–ÑÑ‚Ğ°/Ğ›ĞŸĞ—
    document.getElementById("region")?.addEventListener("input", e => {
      if (typeof onRegionInput === "function") onRegionInput(e);
    });
    document.getElementById("city")?.addEventListener("input", e => {
      if (typeof onCityInput === "function") onCityInput(e);
    });
    document.getElementById("lpz")?.addEventListener("input", e => {
      if (typeof onLPZInput === "function") onLPZInput(e);
    });

    // ğŸ”§ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ KPâ€‘ÑĞ¿Ğ¸ÑĞºÑƒ
    fetch("../calculators/kp-list.json")
      .then(res => res.json())
      .then(data => {
        data.forEach(entry => {
          kpListByDevice[entry.device] = entry.KP;
        });
      })
      .catch(err => console.warn("âš ï¸ ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ kp-list.json", err));

    // ğŸ”§ Ğ¯ĞºÑ‰Ğ¾ Ñ€ĞµĞ´Ğ°Ğ³ÑƒÑ”Ğ¼Ğ¾ Ñ–ÑĞ½ÑƒÑÑ‡Ñƒ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ–Ñ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½Ğ¸Ñ‚Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ñƒ
    const editData = JSON.parse(localStorage.getItem("editLabCard") || "null");
    if (editData && editData.lab) {
      const lab = editData.lab;
      document.getElementById("partnerName").value = lab.partner || "";
      document.getElementById("region").value = lab.region || "";
      document.getElementById("city").value = lab.city || "";
      document.getElementById("lpz").value = lab.institution || "";
      document.getElementById("labAddress").value = lab.address || "";
      document.getElementById("contractor").value = lab.contractor || "";
      document.getElementById("phone").value = lab.phone || "";
      document.getElementById("labEdrpou").value = lab.edrpou || "";
      document.getElementById("labManager").value = lab.manager || "";

      // ğŸ”§ Ğ’Ñ–Ğ´Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¸ÑÑ‚Ñ€Ğ¾Ñ—Ğ²
      lab.devices.forEach((device, i) => {
        if (typeof addDevice === "function") addDevice(i, device); 
        // Ñ‚ĞµĞ¿ĞµÑ€ addDevice ÑÑ‚Ğ²Ğ¾Ñ€ÑÑ” Ğ±Ğ»Ğ¾Ğº Ğ· Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¸Ğ¼ Ñ–Ğ½Ğ´ĞµĞºÑĞ¾Ğ¼ Ñ– Ğ¾Ğ´Ñ€Ğ°Ğ·Ñƒ Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½ÑÑ” Ğ´Ğ°Ğ½Ñ–
      });
    }
  });
</script>
</body>
</html>
