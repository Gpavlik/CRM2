<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìã –°–ø–∏—Å–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-pip/leaflet-pip.min.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"/>
  <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

  <!-- XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- –°—Ç–∏–ª—ñ -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #006400, #004d00);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { margin-top: 30px; }
    .dashboard {
      max-width: 1200px;
      width: 95%;
      margin: 20px auto;
      padding: 20px;
      background: #008000;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    .lab-card {
      background: #fff;
      color: #000;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .lab-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .lab-actions button {
      flex: 1;
      padding: 6px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }
    .lab-actions button:nth-child(1) { background: #009933; color: #fff; } /* —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ */
    .lab-actions button:nth-child(2) { background: #cc0000; color: #fff; } /* –≤–∏–¥–∞–ª–∏—Ç–∏ */
    .lab-actions button:nth-child(3) { background: #0066cc; color: #fff; } /* —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–∑–∏—Ç */
    .lab-actions button:hover { opacity: 0.85; }
    button {
      margin: 4px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #006400;
      color: #fff;
    }
    button:hover { background-color: #003300; }
    input{
      width: 96%;
      padding: 6px;
      border-radius: 4px;
      border: none;
    }
    select {
      width: 100%;
      padding: 6px;
      border-radius: 4px;
      border: none;
    }
    .hrefs {
      text-align: center;
      margin-top: 10px;
    }
    #filters {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 95%;
      margin: 20px auto;
    }
    .filters-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
    }
    .filters-row label {
      flex: 1 1 20%;
      min-width: 180px;
      background: #004d00;
      padding: 6px;
      border-radius: 6px;
    }
    #pagination { margin-top: 20px; text-align: center; }
    #pagination button { margin: 4px; }
    #purchasesTable {
      width: 100%;
      border-collapse: collapse;
    }
    #purchasesTable th,
    #purchasesTable td {
      border: 1px solid white;
      padding: 8px;
      text-align: left;
    }
    #purchasesTable th {
      background-color: #333;
      color: white;
    }
    #purchasesTable tr:hover {
      background-color: #45ff8391;
    }
  </style>
</head>
<body>
  <img src="../logo.svg" alt="logo" width="220">
  <h1 style="text-align: center;">üìã –°–ø–∏—Å–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π</h1>

  <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
  <section id="filters">
    <div class="filters-row">
     <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ –æ—Å–æ–±–∞ (–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç):
      <input type="text" id="contractor" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º‚Äô—è">
        <datalist id="contractor"></datalist>
      </label>
      <label>
      <div id="managerFilterContainer"></div>
      </label>  
      <label>–û–±–ª–∞—Å—Ç—å: 
        <input type="text" id="filterRegion" list="regionOptions">
        <datalist id="regionOptions"></datalist>
      </label>
      <label>–ú—ñ—Å—Ç–æ:
        <input type="text" id="filterCity" list="cityOptions">
        <datalist id="cityOptions"></datalist>
      </label>
      <label>–õ–ü–ó:
        <input type="text" id="filterInstitution" list="institutionOptions">
        <datalist id="institutionOptions"></datalist>
      </label>
      <label>–ü—Ä–∏–ª–∞–¥:
        <input type="text" id="filterDevice" list="deviceOptions">
        <datalist id="deviceOptions"></datalist>
      </label>
      <label>–ö–ü:
        <input type="text" id="filterKp" list="kpOptions">
        <datalist id="kpOptions"></datalist>
      </label>
      <label>–Ñ–î–†–ü–û–£:
        <input type="text" id="filterEdrpou" list="edrpouOptions">
        <datalist id="edrpouOptions"></datalist>
      </label>
      <label>–õ–∞–±—Ä–∞—Ç–æ—Ä—ñ—ó: 
        <select id="filterDevices"> 
          <option value="all">–£—Å—ñ</option> 
          <option value="with">–ó –ø—Ä–∏–ª–∞–¥–∞–º–∏</option> 
          <option value="without">–ë–µ–∑ –ø—Ä–∏–ª–∞–¥—ñ–≤</option>
        </select>
      </label>
    </div>
    <div class="hrefs">
      <button type="button" onclick="applyFilters()">üîç –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
      <button type="button" onclick="resetFilters()">‚ôªÔ∏è –°–∫–∏–Ω—É—Ç–∏</button>
      <button onclick="exportLabsToExcel()">–ï–∫—Å–ø–æ—Ä—Ç –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π</button>
      <a href="../calendar/calendar.html"><button>üìÖ –î–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è</button></a>
      <button onclick="generateAllLabVisits()">üìÖ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤—ñ–∑–∏—Ç–∏</button>
      <button type="button" onclick="createNewLab()">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—é</button>
      <a href="../index.html"><button>üè† –ù–∞–∑–∞–¥</button></a>
    </div>
  </section>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ–∫ -->
  <div id="labsContainer" class="dashboard"></div>

  <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
  <div id="pagination"></div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–∑–∏—Ç—É -->
  <div id="createVisitModal" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); 
       background:#fff; color:#000; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.6); 
       padding:20px; z-index:1000; width:300px;">
    <span class="close" onclick="closeCreateVisitModal()" 
          style="float:right; cursor:pointer; font-size:20px;">&times;</span>
    <h3>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–∑–∏—Ç—É</h3>
    <label>–î–∞—Ç–∞: <input type="date" id="visitDate"></label><br><br>
    <label>–ß–∞—Å: <input type="time" id="visitTime"></label><br><br>
    <button onclick="confirmCreateVisit()">‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
    <button onclick="closeCreateVisitModal()">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–∞–ø–∏ -->
  <div id="map" style="width:95%; height:500px; margin:20px auto; border-radius:12px;"></div>

  
  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ–π —É –∑–æ–Ω—ñ -->
  <div id="mapModal" style="display:none; position:fixed; top:10%; left:10%; width:80%; height:70%; 
       background:#fff; color:#000; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.6); 
       overflow:auto; padding:20px; z-index:1000;">
    <h2>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó —É –≤–∏–¥—ñ–ª–µ–Ω—ñ–π –∑–æ–Ω—ñ</h2>
    <table id="modalTable" border="1" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç</th>
          <th>–ú—ñ—Å—Ç–æ</th>
          <th>–õ–ü–ó</th>
          <th>–Ñ–î–†–ü–û–£</th>
          <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑–∞–∫—É–ø—ñ–≤–µ–ª—å -->
  <div id="purchasesModal" style="display:none; position:fixed; top:10%; left:10%; width:80%; height:70%; 
       background:#fff; color:#000; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.6); 
       overflow:auto; padding:20px; z-index:1000;">
    <button onclick="exportPurchasesToExcel()">–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–∫—É–ø—ñ–≤–µ–ª—å</button>
    <button onclick="closePurchasesModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
      <h2>–ó–∞–∫—É–ø—ñ–≤–ª—ñ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 90 –¥–Ω—ñ–≤</h2>
    <div id="purchasesSummary" style="margin-top:15px; font-weight:bold;"></div>
    <table id="purchasesTable">
  <thead>
    <tr>
      <th onclick="sortTable(0)">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è <span class="sort-icon"></span></th>
      <th onclick="sortTable(1)">–ü—Ä–µ–¥–º–µ—Ç <span class="sort-icon"></span></th>
      <th onclick="sortTable(2)">–ö—ñ–ª—å–∫—ñ—Å—Ç—å <span class="sort-icon"></span></th>
      <th onclick="sortTable(3)">–î–∞—Ç–∞ <span class="sort-icon"></span></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

    </div>

  <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–ø—ñ–ª—å–Ω–∏—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤ -->
  <script src="../shared/cache.js"></script>
  <script src="logistics.js"></script>
  <script src="labcards.js"></script>
</body>
</html>

